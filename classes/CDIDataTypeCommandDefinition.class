<?php

/**
 * Default implementation of a datatype command definition.
 */
class CDIDataTypeCommandDefinition extends CDIAbstractCommandDefinition {
  
  /**
   * Constructor.
   * 
   * @param string $label
   *   The human-readable English name of this command.
   * @param string $commandClass
   *   The classname of the command class.
   * @param string $facadeClass
   *   The classname of the facade class.
   * @param string $interface
   *   The classname of the interface.
   * @param string $shortcut
   *   A shortcut string for $facadeClass.
   */
  public function __construct($label, $commandClass, $facadeClass, $interface, $shortcut) {
    parent::__construct($label, $shortcut, $commandClass, $facadeClass, array(
      'CDIDataObjectInterface',
      'CDIDataTypeInterface',
    ), array($interface));
  }
  
  public function validateReceiver(CDIReceiverInterface $receiver, CDIDataInterface $data) {
    if (!parent::validateReceiver($receiver, $data)) {
      return FALSE;
    }
    if ($receiver instanceof CDIAbstractTypedReceiver) {
      $supportedTypes = $receiver->supportedTypes();
      $type = NULL;
      if ($data instanceof CDIDataTypeInterface) {
        $type = $data->getDataTypeName();
      }
      elseif ($data instanceof CDIDataObjectInterface) {
        $type = $data->getDataType()->getDataTypeName();
      }
      else {
        return FALSE;
      }
      if (in_array($type, $supportedTypes)) {
        return TRUE;
      }
    }
    return FALSE;
  }
  
}